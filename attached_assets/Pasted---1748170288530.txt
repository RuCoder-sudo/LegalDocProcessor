# Команды для развертывания обновленной версии LegalDocProcessor

# 1. Остановить текущий процесс
pm2 stop legaldoc
pm2 delete legaldoc

# 2. Перейти в директорию проекта
cd /root/LegalDocProcessor

# 3. Установить зависимости
npm install

# 4. Настроить базу данных (если нужно)
npm run db:push

# 5. Запустить новую версию
PORT=3001 DATABASE_URL="postgresql://legaldoc:yourpassword@localhost:5432/legaldocdb" NODE_ENV=production pm2 start npm --name "legaldoc" -- run dev

# 6. Проверить статус
pm2 status
pm2 logs legaldoc

# 7. Настроить Nginx (если еще не настроен)
rm -f /etc/nginx/sites-enabled/legalrfdocs.ru
ln -s /etc/nginx/sites-available/legalrfdocs.conf /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

# 8. Проверить что сайт работает
curl http://localhost:3001
curl http://legalrfdocs.ru

# Альтернативная команда запуска (если нужно):
# cd /root/LegalDocProcessor && PORT=3001 DATABASE_URL="postgresql://legaldoc:yourpassword@localhost:5432/legaldocdb" NODE_ENV=production npm start

echo "✅ Развертывание завершено! Сайт должен работать на legalrfdocs.ru"